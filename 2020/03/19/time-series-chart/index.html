<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 时间序列图的所有秘籍 · Johnny Happy's Blog</title><meta name="description" content="时间序列图的所有秘籍 - Johnny Happy"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="Johnny Happy's Blog"><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="Johnny Happy's Blog" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/johnnyhappy365" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">时间序列图的所有秘籍</h1><div class="post-info">Mar 19, 2020</div><div class="post-content"><p>时间序列在数据可视化中比较常见，通过是表达随时间的变化(x 轴)指标(y 轴)是如何变化的。本文介绍一些在表示时间序列的时候的一些知识点和技巧，在最后给出一个 cheatsheet 可以快速查阅。</p>
<h2 id="二维"><a href="#二维" class="headerlink" title="二维"></a>二维</h2><p>时间序列通常是一个二维的图表，X 轴用来表示时间轴，Y 轴用来表示指标轴。比如在</p>
<a href="/2020/03/14/write-a-line-chart-using-d3/" title="一步一步用 D3js 写一个 Line Char">一步一步用 D3js 写一个 Line Char</a>介绍的 line chart

<p><img src="/images/linechart__series.png" alt="line chart"></p>
<h4 id="x-轴"><a href="#x-轴" class="headerlink" title="x 轴"></a>x 轴</h4><p>通过使用线性的时间缩放，在 d3js 中可以使用 <code>scaleTime</code>来实现。时间显示的粒度通常要根据具体业务来确定，有的可以看年统计，也有的按小时统计。</p>
<p>另外，在显示 x 轴的 tick 的时候，因为日期的不同粒度以及不同的时间显示精度，经常是需要把 x 轴的时间做格式化的。如按天为粒度的时间序列图可以显示格式为<code>MM-DD</code>。</p>
<h4 id="y-轴"><a href="#y-轴" class="headerlink" title="y 轴"></a>y 轴</h4><p>y 轴通常用来表示指标，它可能是一个具体的数据记录也可能是聚合后的数据。有时，也会使用双 y 轴的情况，这时会显示两个 Series 分别用不同的 y 轴来解释。这种场景是为了强调二个指标随着同一段时间变化时的相关关系。</p>
<h2 id="Series"><a href="#Series" class="headerlink" title="Series"></a>Series</h2><h4 id="离散数据与连续数据"><a href="#离散数据与连续数据" class="headerlink" title="离散数据与连续数据"></a>离散数据与连续数据</h4><p>离散数据是经常聚合后的数据，如每小时/天的 sum/avg 值等。</p>
<h2 id="Series-的表示形式"><a href="#Series-的表示形式" class="headerlink" title="Series 的表示形式"></a>Series 的表示形式</h2><p>下面说说数据序列，基于时间序列的指标展示有多种方式，每种方式有其特殊的适用场景。</p>
<h4 id="column-chart-柱形图-直方图"><a href="#column-chart-柱形图-直方图" class="headerlink" title="column chart 柱形图/直方图"></a>column chart 柱形图/直方图</h4><p>column chart 通常是用来显示聚合后的离散数据的。使用柱图可以强化柱之间的比较效果。</p>
<p><img src="/images/columnchart__series.png" alt="column chart"></p>
<h4 id="scatter-chart-散点图"><a href="#scatter-chart-散点图" class="headerlink" title="scatter chart/散点图"></a>scatter chart/散点图</h4><p>散点图最大的特点我觉得有二个，一是两个轴都是连续型的或数据型的。二是用小圆点来表示一个数据点。在这个二维平面上，散点图的最大的意义大于提示二个轴所代表的指标的几何意义。比如下图，两个指标就是就代表了两个指标是<code>正相关</code>的。<br><img src="/images/scatterchart__series.png" alt="scatter chart"><br>除了<code>正相关</code>散点图还可以表达<code>不相关</code>/<code>聚焦</code>/<code>负相关</code>等含义</p>
<h4 id="line-chart-折线图"><a href="#line-chart-折线图" class="headerlink" title="line chart/折线图"></a>line chart/折线图</h4><p>把 scatter chart 中的点用直线连接在一起就变成了 line chart。这种连接会在视觉上让用户更倾向于 y 轴数据的变化关系，而不再纠结与 x 与 y 轴的关系。</p>
<p>在 line chart 默认是使用直线的，有些图表库要支持使用 spline line 的方式来拟合。这种拟合其实是与实际的指标变化无关的，我觉得可能更多的是从美观度上的考虑。</p>
<h4 id="step-chart-阶梯图"><a href="#step-chart-阶梯图" class="headerlink" title="step chart/阶梯图"></a>step chart/阶梯图</h4><p>有时指标在一个不能在图表上再分的时间段内是固定不变的。如银行利率在很长一段时间是不会改变的。为了强调这种<code>不变</code>的关系。用 step chart 就非常适合。</p>
<p>step chart 在画 series 时也是使用<code>d3.line</code>进行绘制然后生成一个 path。区别是，在原有的数据点之外还要再补充一些点才能画出这种直角的感觉。<br>参考代码如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">initSeries() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">this</span>.config</span><br><span class="line">    <span class="keyword">const</span> that = <span class="keyword">this</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> stepData: DataItem[] = []</span><br><span class="line">    data.forEach(<span class="function">(<span class="params">d: DataItem, i: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">      stepData.push(d)</span><br><span class="line">      <span class="keyword">if</span> (i !== data.length - <span class="number">1</span>) &#123;</span><br><span class="line">        stepData.push(&#123;</span><br><span class="line">          x: data[i + <span class="number">1</span>].x,</span><br><span class="line">          y: d.y</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> line = d3</span><br><span class="line">      .line()</span><br><span class="line">      .x(<span class="function">(<span class="params">d: <span class="built_in">any</span>, i: <span class="built_in">number</span></span>) =&gt;</span> that.x(d.x))</span><br><span class="line">      .y(<span class="function">(<span class="params">d: <span class="built_in">any</span>, i: <span class="built_in">number</span></span>) =&gt;</span> that.y(d.y))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.series = <span class="keyword">this</span>.svg</span><br><span class="line">      .append(<span class="string">'path'</span>)</span><br><span class="line">      .datum(stepData) <span class="comment">// 10. Binds data to the line</span></span><br><span class="line">      .attr(<span class="string">'class'</span>, <span class="string">'line'</span>) <span class="comment">// Assign a class for styling</span></span><br><span class="line">      .attr(<span class="string">'d'</span>, line)</span><br><span class="line">      .attr(<span class="string">'fill'</span>, <span class="string">'none'</span>)</span><br><span class="line">      .attr(<span class="string">'stroke'</span>, Colors.primary)</span><br><span class="line">      .attr(<span class="string">'stroke-width'</span>, <span class="number">3</span>)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p><code>d3js</code>提供了这种便利性，可以通过设置 curve 来实现, 效果是一样的。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> line = d3</span><br><span class="line">  .line()</span><br><span class="line">  .x(<span class="function">(<span class="params">d: <span class="built_in">any</span>, i: <span class="built_in">number</span></span>) =&gt;</span> that.x(d.x))</span><br><span class="line">  .y(<span class="function">(<span class="params">d: <span class="built_in">any</span>, i: <span class="built_in">number</span></span>) =&gt;</span> that.y(d.y))</span><br><span class="line">  .curve(d3.curveStep)</span><br></pre></td></tr></table></figure>

<p><img src="/images/stepchart__series.png" alt="step chart"></p>
<h2 id="cheatsheet"><a href="#cheatsheet" class="headerlink" title="cheatsheet"></a>cheatsheet</h2><p>在时间序列的展示形式选择的时候可以参考这个 cheatsheet。</p>
<table>
<thead>
<tr>
<th></th>
<th>column</th>
<th>scatter</th>
<th>line</th>
<th>step</th>
</tr>
</thead>
<tbody><tr>
<td>离散数据</td>
<td>最适合</td>
<td>适合</td>
<td></td>
<td></td>
</tr>
<tr>
<td>连续数据</td>
<td></td>
<td>适合</td>
<td>适合</td>
<td>适合</td>
</tr>
<tr>
<td>时间段内数据不变</td>
<td></td>
<td></td>
<td></td>
<td>最适合</td>
</tr>
<tr>
<td>强调指标之间的对比</td>
<td>最适合</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>强调时间与指标指间的几何关系</td>
<td></td>
<td>最适合</td>
<td>适合</td>
<td></td>
</tr>
</tbody></table>
</div></article></div></main><footer><div class="paginator"><a href="/2020/03/30/hierarchy-visualization/" class="prev">PREV</a><a href="/2020/03/14/amazing-life-note-1/" class="next">NEXT</a></div><div class="copyright"><p>© 2019 - 2020 <a href="http://yoursite.com">Johnny Happy</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>